{% extends "base.html" %}
{% block title %}Donation Confirmed{% endblock %}

{% block head %}
{{ super() }}
<style>
  .confetti-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 70%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <!-- Confirmation Icon and Message -->
  <div class="text-center mb-10">
    <div class="mx-auto flex items-center justify-center w-20 h-20 rounded-full bg-green-500 shadow-md mb-4 animate-bounce">
      <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
        <path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </div>
    <h1 class="text-3xl font-bold text-gray-800">Thank You, {{ current_user.first_name }}!</h1>
    <p class="mt-2 text-lg text-gray-600">Your donation was successfully completed.</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Donation Details -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-600 hover:shadow-xl transition-all duration-300">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2 text-blue-800">
        <i class="bi bi-receipt"></i> Donation Details
      </h2>
      <dl class="space-y-3 text-gray-700">
        <div class="flex justify-between">
          <dt class="font-medium">Amount:</dt>
          <dd>{{ donation.amount|currency }} {{ donation.currency }}</dd>
        </div>
        <div class="flex justify-between">
          <dt class="font-medium">Date:</dt>
          <dd>{{ donation.created_at|datetime_format }}</dd>
        </div>
        <div class="flex justify-between">
          <dt class="font-medium">Payment Method:</dt>
          <dd>•••• {{ donation.payment_method_last4 }}</dd>
        </div>
        {% if donation.program and program_url %}
        <div class="flex justify-between">
          <dt class="font-medium">Program:</dt>
          <dd><a href="{{ program_url }}" class="text-blue-600 hover:underline">{{ donation.program.title }}</a></dd>
        </div>
        {% endif %}
      </dl>
      <div class="mt-6 text-right">
        <a href="{{ receipt_url }}" class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 border border-blue-600 px-4 py-2 rounded-lg transition">
          <i class="bi bi-download"></i> Download Receipt
        </a>
      </div>
    </div>

    <!-- Impact Section -->
    <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 border-l-4 border-green-500">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2 text-green-700">
        <i class="bi bi-graph-up"></i> Your Impact
      </h2>
      <div class="grid grid-cols-2 text-center border rounded-lg overflow-hidden">
        <div class="p-4 border-r">
          <h3 class="text-2xl font-bold text-blue-600">{{ impact_stats.total_donated|currency }}</h3>
          <p class="text-sm text-gray-500">Total Given</p>
        </div>
        <div class="p-4">
          <h3 class="text-2xl font-bold text-green-600">{{ impact_stats.donation_count }}</h3>
          <p class="text-sm text-gray-500">Total Donations</p>
        </div>
      </div>

      {% if user_donations %}
      <div class="mt-6">
        <h4 class="font-semibold text-gray-800 mb-2">Recent Donations:</h4>
        <ul class="divide-y divide-gray-200">
          {% for d in user_donations %}
          <li class="py-2 flex justify-between text-sm text-gray-700">
            <span>{{ d.amount|currency }} {% if d.program %}to {{ d.program.title }}{% endif %}</span>
            <span class="text-gray-400">{{ d.created_at|datetime_format('short') }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Next Steps -->
  <div class="mt-12 text-center">
    <a href="{{ url_for('main.home') }}" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg shadow hover:bg-blue-700 transition-all mr-3">
      Return Home
    </a>
    {% if donation.program and program_url %}
    <a href="{{ program_url }}" class="inline-block border border-blue-600 text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition-all">
      View Program
    </a>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  confetti({
    particleCount: 150,
    spread: 70,
    origin: { y: 0.6 },
    ticks: 200
  });
});
</script>
{% endblock %}
